# シナリオファイル例

自然言語でテストシナリオを記述し、AIが自動的にテストを実行します。

## 基本的な書き方

シナリオはプレーンテキストで自由に記述できます。AIがシナリオを解釈し、適切なアクションとアサーションに変換します。

---

## シナリオ例

### 1. 基本接続テスト

```
シナリオ: サーバー接続確認

1. サーバーに接続する
2. 接続されていることを確認する
3. 2秒待機する
4. サーバーから切断する
```

### 2. ヘルプコマンドテスト

```
シナリオ: ヘルプコマンドの動作確認

前提: サーバーに接続済み

ステップ:
1. /help コマンドを実行する
2. 5秒以内に「help」を含むメッセージが表示されることを確認する
```

### 3. ゲームモード変更テスト

```
シナリオ: ゲームモード切り替え

1. サーバーに接続
2. /gamemode creative コマンドを実行
3. 3秒待機
4. ゲームモードがクリエイティブであることを確認
5. /gamemode survival コマンドを実行
6. 3秒待機
7. ゲームモードがサバイバルであることを確認
```

### 4. タイトル表示テスト

```
シナリオ: タイトルコマンドのテスト

1. サーバーに接続する
2. /title @s title Hello World コマンドを送信する
3. 5秒以内に「Hello World」というタイトルが表示されることを確認する
```

### 5. テレポートテスト

```
シナリオ: テレポート機能の確認

1. サーバーに接続
2. 座標 (100, 64, 100) にテレポートする
3. 1秒待機
4. プレイヤーが座標 (100, 64, 100) の近く（距離5以内）にいることを確認
```

### 6. インベントリテスト

```
シナリオ: アイテム付与とインベントリ確認

1. サーバーに接続する
2. /clear @s コマンドでインベントリをクリア
3. 1秒待機
4. インベントリが空であることを確認
5. /give @s diamond 64 コマンドを実行
6. 2秒待機
7. インベントリにダイヤモンドがあることを確認
```

### 7. 体力テスト

```
シナリオ: 体力の確認

1. サーバーに接続
2. 体力が0より大きいことを確認
3. /effect @s instant_damage 1 10 でダメージを与える
4. 2秒待機
5. 体力が20より小さいことを確認
```

### 8. エフェクトテスト

```
シナリオ: エフェクト付与の確認

1. サーバーに接続する
2. /effect @s speed 60 1 コマンドでスピードエフェクトを付与
3. 2秒待機
4. プレイヤーがスピードエフェクトを持っていることを確認
```

### 9. フォーム表示テスト

```
シナリオ: フォームUIの表示確認

1. サーバーに接続
2. /form コマンドを実行（フォームを表示するプラグインコマンド）
3. 5秒以内にフォームが表示されることを確認
```

### 10. マルチステップ総合テスト

```
シナリオ: 総合動作確認テスト

このシナリオでは、サーバーの基本機能を包括的にテストします。

ステップ:
1. サーバーに接続する
2. 接続が成功していることを確認
3. /help コマンドを実行してヘルプを表示
4. ヘルプメッセージを受信することを確認
5. 座標 (0, 100, 0) にテレポート
6. 2秒待機
7. ゲームモードがサバイバルであることを確認
8. 体力が0より大きいことを確認
9. チャットで「テスト完了」と送信
10. サーバーから切断
```

---

## 使用方法

### Go コードから実行

```go
package main

import (
    "fmt"
    "github.com/gollilla/best"
)

func main() {
    // エージェント作成
    agent := best.CreateAgent("TestBot")

    // ファイルからシナリオを実行
    result, err := best.RunScenarioFromFile(
        "examples/scenarios/basic_connection.txt",
        agent,
        best.ScenarioWithVerbose(true),
    )

    if err != nil {
        fmt.Printf("Error: %v\n", err)
        return
    }

    // 結果を表示
    reporter := best.NewScenarioConsoleReporter()
    reporter.ReportResult(result)
}
```

### 文字列から直接実行

```go
scenario := `
シナリオ: 簡単なテスト
1. サーバーに接続
2. /help を実行
3. ヘルプが表示されることを確認
`

result, err := best.RunScenarioFromString(scenario, agent)
```

---

## 設定ファイル

`best.config.yml` でAI設定を行います：

```yaml
ai:
  provider: openai        # または anthropic
  apiKey: ${OPENAI_API_KEY}
  model: gpt-4
  temperature: 0.7
  maxTokens: 4096
```

---

## 利用可能なアクション

| アクション | 説明 | 例 |
|-----------|------|-----|
| connect | サーバーに接続 | 「サーバーに接続する」 |
| disconnect | サーバーから切断 | 「切断する」 |
| command | コマンド実行 | 「/help コマンドを実行」 |
| chat | チャット送信 | 「こんにちはと送信」 |
| wait | 待機 | 「3秒待機する」 |
| goto | テレポート | 「座標(100,64,100)に移動」 |
| look_at | 方向を向く | 「座標(0,0,0)を向く」 |

## 利用可能なアサーション

| アサーション | 説明 | 例 |
|-------------|------|-----|
| assert_connected | 接続確認 | 「接続されていることを確認」 |
| assert_chat | チャット受信確認 | 「"hello"を含むメッセージを確認」 |
| assert_health_above | 体力が指定値以上 | 「体力が10より大きいことを確認」 |
| assert_gamemode | ゲームモード確認 | 「サバイバルモードであることを確認」 |
| assert_position_near | 座標確認 | 「座標(0,64,0)の近くにいることを確認」 |
| assert_inventory_has_item | アイテム所持確認 | 「ダイヤモンドを持っていることを確認」 |
| assert_title | タイトル表示確認 | 「"Welcome"というタイトルを確認」 |
| assert_effect_has | エフェクト確認 | 「スピードエフェクトがあることを確認」 |
